apiVersion: v1
kind: Pod
metadata:
  name: v2v-diffusion-interactive
  labels:
    app: v2v-diffusion
    type: interactive
spec:
  restartPolicy: Never

  containers:
  - name: training
    image: kkokate990/v2v-diffusion:latest  # Replace with your Docker image
    imagePullPolicy: Always

    command: ["/bin/bash"]
    args: ["-c", "sleep infinity"]  # Keep container running

    resources:
      requests:
        memory: "32Gi"
        cpu: "8"
        nvidia.com/gpu: "1"
      limits:
        memory: "64Gi"
        cpu: "16"
        nvidia.com/gpu: "1"

    volumeMounts:
    - name: storage
      mountPath: /workspace/storage
    - name: dshm
      mountPath: /dev/shm

    env:
    - name: PYTHONUNBUFFERED
      value: "1"
    - name: TORCH_HOME
      value: "/workspace/storage/.cache/torch"
    - name: HF_HOME
      value: "/workspace/storage/.cache/huggingface"

  volumes:
  - name: storage
    persistentVolumeClaim:
      claimName: v2v-diffuser-kuntal
  - name: dshm
    emptyDir:
      medium: Memory
      sizeLimit: "8Gi"

  # Node selector for GPU nodes
  nodeSelector:
    nvidia.com/gpu.product: NVIDIA-A100-SXM4-40GB  # Adjust based on available GPUs
